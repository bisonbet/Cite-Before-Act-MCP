# =============================================================================
# Cite-Before-Act MCP - Global Configuration and Secrets
# =============================================================================
# Copy this file to .env and edit as desired
# cp .env.example .env
#
# IMPORTANT: This .env file must be in the project root directory
# (same directory as this .env.example file). The server automatically
# finds it using an absolute path, so it works regardless of which
# directory the MCP client launches the server from.
#
# =============================================================================
# Configuration Architecture
# =============================================================================
#
# Cite-Before-Act uses a two-tier configuration system:
#
# 1. THIS .ENV FILE (Global defaults and secrets)
#    - Secrets: GITHUB_PERSONAL_ACCESS_TOKEN, SLACK_BOT_TOKEN, etc.
#    - Global settings: ENABLE_SLACK, USE_LOCAL_APPROVAL, etc.
#    - Applies to ALL wrapped MCP servers
#
# 2. CLAUDE DESKTOP CONFIG mcpServers.env (Per-server config)
#    - Server-specific: UPSTREAM_COMMAND, UPSTREAM_ARGS, UPSTREAM_TRANSPORT
#    - Per-server overrides: DETECTION_ALLOWLIST, DETECTION_BLOCKLIST
#    - Each wrapped server can have different upstream config
#
# Environment variable precedence:
#   1. mcpServers.env (highest priority) - per-server overrides
#   2. This .env file (lower priority) - global defaults
#
# This allows you to:
# - Share secrets across multiple wrapped servers
# - Use same Slack config for all servers
# - Override settings per-server when needed
#
# =============================================================================

# -----------------------------------------------------------------------------
# Secrets and Tokens
# -----------------------------------------------------------------------------
# Store all sensitive tokens here instead of in Claude Desktop config.
# This keeps secrets out of config files and works across different OS's.
# NEVER commit this file to git!

# GitHub Personal Access Token (for GitHub MCP Server)
# Get from: https://github.com/settings/tokens
# Required scopes: repo, workflow, write:packages, delete:packages, admin:org
# (Or use minimal scopes needed for your use case)
# Format: ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
GITHUB_PERSONAL_ACCESS_TOKEN=

# Alternative: Generic upstream auth token (if not using GitHub)
# This will be automatically formatted as "Bearer {token}" for Authorization header
UPSTREAM_AUTH_TOKEN=

# -----------------------------------------------------------------------------
# Slack Configuration (OPTIONAL - Global)
# -----------------------------------------------------------------------------
# Local approval works by default with GUI popups. Only configure Slack if you
# want team-wide approval workflows via Slack channels.
# These settings apply to ALL wrapped MCP servers.

# Slack Bot Token (required if using Slack)
# Get this from: https://api.slack.com/apps -> Your App -> OAuth & Permissions
# Token format: xoxb-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx
SLACK_BOT_TOKEN=

# Slack Channel (optional)
# For PUBLIC channels: Use channel name with # (e.g., #approvals) or channel ID (C1234567890)
# For PRIVATE channels: Use channel name WITHOUT # (e.g., approvals) or group ID (G1234567890)
# Note: Bot must be invited to private channels: /invite @YourBotName
# If not set, SLACK_USER_ID must be set for direct messages
# SLACK_CHANNEL=approvals  # Private channel (no #)
# SLACK_CHANNEL=#approvals  # Public channel (with #)

# Slack User ID (optional)
# User ID for sending direct messages instead of channel messages
# Format: U1234567890
# SLACK_USER_ID=U1234567890

# Slack Signing Secret (required for webhook server in production mode)
# Get this from: https://api.slack.com/apps -> Your App -> Basic Information -> Signing Secret
# Only needed if running examples/slack_webhook_server.py in production mode
# SLACK_SIGNING_SECRET=your-signing-secret-here

# -----------------------------------------------------------------------------
# Slack Webhook Server Configuration (OPTIONAL)
# -----------------------------------------------------------------------------
# These settings only apply when running examples/slack_webhook_server.py
# The webhook server enables interactive Approve/Reject buttons in Slack

# Security Mode (default: local)
# - local: For web service hosted (ngrok with traffic policy verification)
#   * Use with ngrok traffic policy for signature verification
#   * Production-ready when ngrok handles verification
# - production: For self-hosted (direct internet exposure - cloud/VPS)
#   * Application-level HMAC verification + rate limiting
# SECURITY_MODE=local

# Webhook Server Port (default: 3000)
# PORT=3000

# Debug Mode (default: false)
# WARNING: Do not enable in production - exposes stack traces
# DEBUG=false

# Rate Limiting - Production Mode Only (defaults shown)
# Maximum requests allowed per time window
# RATE_LIMIT_MAX_REQUESTS=60
# RATE_LIMIT_WINDOW_SECONDS=60

# -----------------------------------------------------------------------------
# Global Detection Defaults
# -----------------------------------------------------------------------------
# These are global defaults that apply to all wrapped MCP servers.
# They control how the system automatically detects mutating operations.
#
# Per-server DETECTION_ALLOWLIST and DETECTION_BLOCKLIST should be set in
# Claude Desktop's mcpServers.{server-name}.env config, NOT here.

# Enable Convention-Based Detection (default: true)
# If true, tools with names starting with "write_", "delete_", "send_", etc.
# will be automatically detected as mutating
DETECTION_ENABLE_CONVENTION=true

# Enable Metadata-Based Detection (default: true)
# If true, analyzes tool descriptions and metadata to detect mutating operations
DETECTION_ENABLE_METADATA=true

# -----------------------------------------------------------------------------
# Global Approval Settings
# -----------------------------------------------------------------------------
# These apply to ALL wrapped MCP servers. You can override per-server by
# adding these variables to the specific server's env in Claude Desktop config.

# Approval Timeout (default: 300 seconds = 5 minutes)
# How long to wait for approval before automatically rejecting
# Set to 0 for no timeout (wait indefinitely)
APPROVAL_TIMEOUT_SECONDS=300

# Enable Slack Integration (default: true)
# If true, attempts to use Slack for approvals (requires SLACK_BOT_TOKEN)
# If false or if Slack fails, falls back to local approval
ENABLE_SLACK=true

# Use Local Approval (default: true)
# If true, enables local approval (GUI popup or file-based)
# Local approval is always used as fallback even if Slack is configured
# Set to false to disable local approval (Slack only)
USE_LOCAL_APPROVAL=true

# Use Native Dialog (default: true)
# If true, uses native OS dialogs for local approval:
#   - macOS: Uses osascript (AppleScript) - works even in stdio MCP mode
#   - Windows: Uses PowerShell MessageBox - works even in stdio MCP mode
#   - Linux: File-based approval only (no native dialog available)
# If false, uses file-based approval only (writes to /tmp/cite-before-act-approval-*.json)
# Note: File-based approval instructions are ALWAYS shown in logs, regardless of this setting
USE_NATIVE_DIALOG=true

# =============================================================================
# Quick Start Examples
# =============================================================================

# Minimal Configuration (Local Approval Only):
# - No variables needed! Works out of the box with GUI popups.
# - Just run setup_wizard.py and configure your upstream server

# With Slack (Global - applies to all servers):
# SLACK_BOT_TOKEN=xoxb-your-token-here
# SLACK_CHANNEL=#approvals
# ENABLE_SLACK=true
# USE_LOCAL_APPROVAL=true
# USE_NATIVE_DIALOG=false

# With GitHub MCP Server:
# GITHUB_PERSONAL_ACCESS_TOKEN=ghp_your_token_here
# (Server-specific config like UPSTREAM_COMMAND goes in Claude Desktop's mcpServers config)

# =============================================================================
# Per-Server Configuration (Goes in Claude Desktop config, NOT here)
# =============================================================================
#
# These variables should be set in Claude Desktop's mcpServers config:
#
# "mcpServers": {
#   "filesystem-cite": {
#     "command": "python",
#     "args": ["-m", "server.main"],
#     "env": {
#       "UPSTREAM_COMMAND": "npx",
#       "UPSTREAM_ARGS": "-y,@modelcontextprotocol/server-filesystem,/path/to/workspace",
#       "UPSTREAM_TRANSPORT": "stdio",
#       "DETECTION_ALLOWLIST": "write_file,edit_file,create_directory",
#       "DETECTION_BLOCKLIST": "read_file,list_directory"
#     }
#   },
#   "github-cite": {
#     "command": "python",
#     "args": ["-m", "server.main"],
#     "env": {
#       "UPSTREAM_COMMAND": "docker",
#       "UPSTREAM_ARGS": "run,-i,--rm,ghcr.io/github/github-mcp-server",
#       "UPSTREAM_TRANSPORT": "stdio",
#       "DETECTION_ALLOWLIST": "",
#       "DETECTION_BLOCKLIST": "read_file,get_file,list_files,search_code"
#     }
#   }
# }
#
# The setup_wizard.py automatically generates this for you!
#
# =============================================================================
